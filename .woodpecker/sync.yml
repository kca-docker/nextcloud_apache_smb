---
clone:
  - name: git
    image: woodpeckerci/plugin-git
    settings:
      recursive: true
      submodule_override:
        nextcloud: https://github.com/nextcloud/docker.git

when:
  - branch: main
    event: [push]


matrix:
  BASE:
    - apache

steps:
  verify:
    image: forgejo.home309.duckdns.org/containerimages/nextcloud:${BASE}
    commands:
      - php occ --version

  sync:
    image: quay.io/skopeo/stable:latest
    commands:
    #  - skopeo login --username ${FORGEJO_CI_USER} --password ${FORGEJO_CI_PASS} forgejo.home309.duckdns.org/containerimages/nextcloud
      - skopeo sync --dest-registry-token a4ce451120bebe93ba11a77af48b59957a506794 --src docker --dest docker docker.io/nextcloud:${BASE} forgejo.home309.duckdns.org/containerimages/nextcloud
    #  - skopeo logout forgejo.home309.duckdns.org
